![yamdb_final](https://github.com/Vilbert55/yamdb_final/workflows/yamdb_final/badge.svg)
# api_yamdb
   Проект **YaMDb** собирает отзывы и оценки от 1 до 10 на произведения, комментарии пользователей к отзывам. Произведения делятся на категории (пример - «Книги», «Фильмы», «Музыка») и на жанры. Каждое произведение имеет среднюю оценку.
    
## Алгоритм регистрации пользователей
1. Пользователь отправляет запрос с параметром `email` на `/auth/email/`.
2. **YaMDB** отправляет письмо с кодом подтверждения (`confirmation_code`) на адрес  `email` .
3. Пользователь отправляет запрос с параметрами `email` и `confirmation_code` на `/auth/token/`, в ответе на запрос ему приходит `token` (JWT-токен).
4. При желании пользователь отправляет PATCH-запрос на `/users/me/` и заполняет поля в своём профайле (описание полей — в документации).
    
## Пользовательские роли
    - **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.
    - **Аутентифицированный пользователь** — может, как и **Аноним**, читать всё, дополнительно он может публиковать отзывы и ставить рейтинг произведениям (фильмам/книгам/песенкам), может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять **свои** отзывы и комментарии.
    - **Модератор** — те же права, что и у **Аутентифицированного пользователя** плюс право удалять **любые** отзывы и комментарии.
    - **Администратор** — полные права на управление проектом и всем его содержимым. Может создавать и удалять категории и произведения. Может назначать роли пользователям.
    - **Администратор Django** — те же права, что и у роли **Администратор**.
    
## Установка и запуск
Для работы требуется Docker и Docker-compose

Замените значения *server_name* в файле **docker.conf** на *127.0.0.1 localhost*

Создайте .env файл в корне приложения и добавьте следующие параметры
```
DB_ENGINE=django.db.backends.postgresql 
DB_NAME=postgres 
POSTGRES_USER=postgres 
POSTGRES_PASSWORD= # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 
```
Соберите образы и запустите docker-compose командой
```
docker-compose up -d
```
Зайдите в контейнер приложения
```
docker exec -it infra_sp2_web_1 bash
```
Примените миграции и соберите статику
```
python manage.py migrate
python manage.py collectstatic
```
Создайте суперпользователя
```
python manage.py createsuperuser
```

## Примеры запросов и ответов
        Создать новый отзыв. Пользователь может оставить только один отзыв на один объект. Права доступа: Аутентифицированные пользователи.
            POST /titles/{title_id}/reviews/
            {
                "text": "string",
                "score": 1
            }
        
            response:
            {
                "id": 0,
                "text": "string",
                "author": "string",
                "score": 1,
                "pub_date": "2019-08-24T14:15:22Z"
            }
        
        Частично обновить комментарий к отзыву по id.
        Права доступа: Автор комментария, модератор или администратор.
            PATCH /titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
            {
                "text": "string"
            }
            
            response:
            {
                "id": 0,
                "text": "string",
                "author": "string",
                "pub_date": "2019-08-24T14:15:22Z"
            }
            
## Полная документация после установки приложения доступна http://localhost:8000/redoc/

